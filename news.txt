
Скрип вытягивает внутренние ip докеров и формирует апстимы

echo  "upstream user1 {" > default.conf
docker ps|grep -v CONTAINER|grep user1|awk '{print $1}'|xargs docker inspect --format '{{ .NetworkSettings.IPAddress }}'|awk '{print "server " $1 ":80;"}' >> default.conf
echo  "}" >> default.conf

echo  "upstream user2 {" >> default.conf
docker ps|grep -v CONTAINER|grep user2|awk '{print $1}'|xargs docker inspect --format '{{ .NetworkSettings.IPAddress }}'|awk '{print "server " $1 ":80;"}' >> default.conf
echo  "}" >> default.conf




остальная часть  default.conf

server {
 listen 80;

    location /user1 {
        proxy_pass http://user1/index.html;
    }


    location /user2 {
        proxy_pass http://user2/index.html;
    }

}


Dockerfile

FROM nginx

COPY conf/default.conf /etc/nginx/conf.d/default.conf
